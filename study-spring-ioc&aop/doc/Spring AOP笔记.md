# 一. AOP

## 术语

- 连接点（）

- 切点（）

- 通知（）

  需要完成的工作叫做通知，就是你写的业务逻辑中需要比如事务、日志等先定义好，然后需要的地方再去用

- 切面（）

  其实就是通知和切点的结合，通知和切点共同定义了切面的全部内容，它是干什么的，什么时候在哪执行

- 引入

  在不改变一个现有类代码的情况下，为该类添加属性和方法,可以在无需修改现有类的前提下，让它们具有新的行为和状态。其实就是把切面（也就是新方法属性：通知定义的）用到目标类中去

- 目标

  被通知的对象。也就是需要加入额外代码的对象，也就是真正的业务逻辑被组织织入切面。

- 织入

  把切面加入程序代码的过程。切面在指定的连接点被织入到目标对象中，在目标对象的生命周期里有多个点可以进行织入：

  - 编译期：切面在目标类编译时被织入，这种方式需要特殊的编译器
  - 类加载期：切面在目标类加载到JVM时被织入，这种方式需要特殊的类加载器，它可以在目标类被引入应用之前增强该目标类的字节码
  - 运行期：切面在应用运行的某个时刻被织入，一般情况下，在织入切面时，AOP容器会为目标对象动态创建一个代理对象，Spring AOP就是以这种方式织入切面的。



# 二. Spring中AOP

## 切入点

@Pointcut

### 表达式

- execution(方法表达式)

  一般用于指定方法的执行一般用于指定方法的执行

  > 格式：
  >
  > execution(访问类型[可省略] 返回值类型 包路径[可省略] 方法名称（参数...） 异常类型[可省略])

- within(类型表达式)

  匹配指定类型内的方法执行

- this(类型全限定名)

  匹配当前AOP代理对象类型的执行方法；注意是AOP代理对象的类型匹配，这样就可能包括引入接口方法也可以匹配；注意this中使用的表达式必须是类型全限定名，不支持通配符；

- target(类型全限定名)

  匹配当前目标对象类型的执行方法；注意是目标对象的类型匹配，这样就不包括引入接口也类型匹配；注意target中使用的表达式必须是类型全限定名，不支持通配符

- args(参数类型列表)

  匹配当前执行的方法传入的参数为指定类型的执行方法；注意是匹配传入的参数类型，不是匹配方法签名的参数类型；参数类型列表中的参数必须是类型全限定名，通配符不支持；args属于动态切入点，这种切入点开销非常大，非特殊情况最好不要使用

- @annotation(注解类型)

  匹配当前执行方法持有指定注解的方法；注解类型也必须是全限定类型名；

  > 注意：@within和@target针对类的注解，@annotation针对方法的注解

- @within(注解类型)

  匹配所以持有指定注解类型内的方法；注解类型也必须是全限定类型名；

-  @target(注解类型)

  匹配当前目标对象类型的执行方法，其中目标对象持有指定的注解；注解类型也必须是全限定类型名；

- @args(注解列表)

  匹配当前执行的方法传入的参数持有指定注解的执行；注解类型也必须是全限定类型名；

### 运算符

​		&& || !

## 通知

- @Before（前置通知）

​		在方法开始执行前执行

- @After（后置通知）

​		在方法执行后执行

- @AfterReturning（返回后通知）

​		在方法返回后执行

- @AfterThrowing（异常通知）

​		在抛出异常时执行

- @Around（环绕通知）

​		在方法执行前和执行后都会执行

> 执行顺序：
>
> around > before > around > after > afterReturning